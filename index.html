<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Black Market - Produtos</title>
  <style>
    :root {
      --primary-color: #2563eb;
      /* Azul moderno */
      --bg-color: #f3f4f6;
      --card-bg: #ffffff;
      --text-main: #1f2937;
      --text-secondary: #6b7280;
      --price-color: #059669;
      /* Verde */
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, sans-serif;
      background-color: var(--bg-color);
      color: var(--text-main);
      padding-bottom: 100px;
      /* Espaço para o banner flutuante */
    }

    /* --- Cabeçalho Fixo --- */
    header {
      background: var(--card-bg);
      padding: 15px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    h1 {
      font-size: 1.5rem;
      color: #111;
    }

    #busca-container {
      width: 100%;
      max-width: 600px;
      position: relative;
    }

    #busca {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid #e5e7eb;
      border-radius: 50px;
      font-size: 16px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      background-color: #f9fafb;
    }

    #busca:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
      background-color: #fff;
    }

    /* --- Grid de Produtos --- */
    #lista {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 16px;
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .produto {
      background: var(--card-bg);
      border-radius: 12px;
      padding: 12px;
      text-align: center;
      transition: transform 0.2s, box-shadow 0.2s;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      height: 100%;
    }

    .produto:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    }

    .produto img {
      width: 100%;
      height: 150px;
      object-fit: contain;
      background: #f9fafb;
      border-radius: 8px;
      margin-bottom: 12px;
    }

    .nome {
      font-weight: 600;
      font-size: 14px;
      color: var(--text-main);
      margin-bottom: 8px;
      line-height: 1.4;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      min-height: 40px;
      /* Altura fixa para alinhar */
    }

    .preco {
      color: var(--price-color);
      font-weight: 700;
      font-size: 1.1rem;
      margin-top: auto;
      /* Empurra o preço para baixo */
    }

    .empty {
      text-align: center;
      color: var(--text-secondary);
      grid-column: 1 / -1;
      padding: 40px;
      font-size: 1.1rem;
    }

    /* --- Banner Flutuante de Download --- */
    .app-banner {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #111827;
      /* Fundo escuro */
      color: #fff;
      padding: 12px 20px;
      border-radius: 50px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 15px;
      z-index: 1000;
      width: 90%;
      max-width: 500px;
      justify-content: space-between;
      opacity: 0;
      /* Começa invisível para animação */
      animation: slideUp 0.5s forwards 1s;
      /* Aparece após 1s */
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translate(-50%, 20px);
      }

      to {
        opacity: 1;
        transform: translate(-50%, 0);
      }
    }

    .banner-text {
      font-size: 14px;
      font-weight: 500;
    }

    .banner-text span {
      display: block;
      font-size: 12px;
      color: #9ca3af;
      font-weight: 400;
    }

    .store-buttons {
      display: flex;
      gap: 8px;
    }

    .btn-store {
      background-color: var(--primary-color);
      color: white;
      text-decoration: none;
      padding: 8px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      transition: background 0.2s;
      white-space: nowrap;
    }

    .btn-store:hover {
      background-color: #1d4ed8;
    }

    /* Esconde botões por padrão, JS vai mostrar o correto */
    #btn-ios,
    #btn-android {
      display: none;
    }

    @media (min-width: 600px) {
      #lista {
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      }

      .produto img {
        height: 180px;
      }

      h1 {
        font-size: 2rem;
      }
    }
  </style>
</head>

<body>

  <header>
    <h1>Black Market</h1>
    <div id="busca-container">
      <input id="busca" type="search" placeholder="Buscar produtos..." aria-label="Buscar produtos" />
    </div>
  </header>

  <div id="lista">
    <div class="empty">Carregando produtos...</div>
  </div>

  <div class="app-banner" id="appBanner">
    <div class="banner-text">
      Baixe nosso App
      <span>Melhor experiência mobile</span>
    </div>
    <div class="store-buttons">
      <a href="https://apps.apple.com/br/app/black-market/id6741739612?platform=iphone" target="_blank"
        class="btn-store" id="btn-ios">
        App Store
      </a>
      <a href="https://play.google.com/store/apps/details?id=com.guilla.mercadinho" target="_blank" class="btn-store"
        id="btn-android">
        Google Play
      </a>
    </div>
  </div>

  <script>
    // ================= LOGICA DA LOJA (Produtos) =================
    (async function () {
      const API_BASE = "https://mercadinho-guilla-default-rtdb.firebaseio.com";
      const listaEl = document.getElementById('lista');
      const buscaEl = document.getElementById('busca');
      let produtos = [];

      const placeholder = 'data:image/svg+xml;utf8,' + encodeURIComponent(
        `<svg xmlns="http://www.w3.org/2000/svg" width="400" height="300"><rect width="100%" height="100%" fill="#f3f4f6"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#9ca3af" font-size="20" font-family="sans-serif">Sem imagem</text></svg>`
      );

      async function carregar() {
        try {
          const res = await fetch(API_BASE + '/produto.json', { cache: 'no-store' });
          if (!res.ok) throw new Error('Status: ' + res.status);
          const data = await res.json();
          produtos = Object.entries(data || {}).map(([id, item]) => ({ id, ...item }));
          render(produtos);
        } catch (err) {
          listaEl.innerHTML = `<div class="empty">Não foi possível carregar os produtos.<br><small>${err.message}</small></div>`;
        }
      }

      function formatMoney(v) {
        return Number(v || 0).toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
      }

      function escapeHtml(s) {
        return String(s || '').replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
      }

      function render(arr) {
        if (!arr || arr.length === 0) {
          listaEl.innerHTML = `<div class="empty">Nenhum produto encontrado.</div>`;
          return;
        }
        listaEl.innerHTML = arr.map(p => {
          const nome = (p.nome || '').trim() || 'Produto sem nome';
          const preco = p.valor_venda != null ? formatMoney(p.valor_venda) : '0,00';
          const img = p.url_img || p.img || placeholder;

          return `
            <div class="produto">
              <img src="${img}" alt="${escapeHtml(nome)}" onerror="this.src='${placeholder}'" loading="lazy" />
              <div class="nome" title="${escapeHtml(nome)}">${escapeHtml(nome)}</div>
              <div class="preco">R$ ${preco}</div>
            </div>
          `;
        }).join('');
      }

      buscaEl.addEventListener('input', () => {
        const term = buscaEl.value.toLowerCase();
        render(produtos.filter(p => (p.nome || '').toLowerCase().includes(term)));
      });

      await carregar();
    })();

    // ================= LOGICA DO BANNER (Detectar OS) =================
    (function detectPlatformForBanner() {
      const userAgent = navigator.userAgent || navigator.vendor || window.opera;
      const btnIos = document.getElementById('btn-ios');
      const btnAndroid = document.getElementById('btn-android');

      // Se for iOS, mostra botão iOS
      if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
        btnIos.style.display = "inline-block";
        btnAndroid.style.display = "none";
      }
      // Se for Android, mostra botão Android
      else if (/android/i.test(userAgent)) {
        btnAndroid.style.display = "inline-block";
        btnIos.style.display = "none";
      }
      // Se for Desktop ou outro, mostra ambos (padrão para marketing)
      else {
        btnIos.style.display = "inline-block";
        btnAndroid.style.display = "inline-block";
        // Ajuste visual para desktop: muda texto do botão para ser mais curto
        btnIos.textContent = "iOS";
        btnAndroid.textContent = "Android";
      }
    })();
  </script>
</body>

</html>